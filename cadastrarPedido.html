<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar pedido</title>
    <script src="Js/jquery.min.js"></script> <!-- Conexão com Jquery (externo) -->
    <script src="Js/script.js"></script> <!-- Conexão com JavaScript (externo) -->
    <script>
        // Declarando o Banco de Dados (Lanchonete)
        var db = window.openDatabase("Lanchonete", "2.0", "Mybase", 4048);
        /* Criando a Tabela Produtos (armazena os produtos cadastrados) 
        e a Tabela Usuarios (armazena os usuários cadastrados) */
        db.transaction(function(criar){
            criar.executeSql('CREATE TABLE Produtos(CodID INTEGER PRIMARY KEY, nomeProd TEXT, valorProd Real, tipoProd TEXT)');
        });

        ArrCodsProds = []; // Array para armazenar os produtos que estiverem no "carrinho"
        // Função para adicionar um Produto específico ao "carrinho" (lista de pedidos)
        function adicionar(codProduto){
            i = 0;
            dadosDoProduto = []; // Array para armazenar os dados dos produtos
            ArrCodsProds.push(codProduto); // Adicionando um valor no Array "carrinho"
            txtString = document.getElementById('carrinho').innerHTML;
            /* Declarando um laço de repetição (for) para exibir o registro
            do Banco de Dados onde "CodID" seja igual ao parâmetro "codProduto" */
            db.transaction(function(tx){ 
                tx.executeSql('SELECT * FROM Produtos WHERE CodID = ?', [codProduto], function (tx, results) { 
                    len = results.rows.length, i;  
                    for (i = 0; i < len; i++) { 
                        row = results.rows.item(i);
                        dadosDoProduto = [
                            row['CodID'],
                            row['nomeProd'],
                            row['valorProd'],
                            row['tipoProd']
                        ];

                        /* Substituindo as vírgulas(,) por ponto(.) e transformando o objeto em
                        valor numérico */
                        vlrDoProduto = dadosDoProduto[2].replace(',', '.');
                        vlrDoProduto = parseFloat(vlrDoProduto).toFixed(2);
                        // Exibindo os produtos (dados) no carrinho
                        document.getElementById('carrinho').innerHTML += "<p id='p"+ dadosDoProduto[0] +"'>" + dadosDoProduto[1] + " ("+ dadosDoProduto[3] +") - <button onclick='menos(" + dadosDoProduto[0] + "," + vlrDoProduto + ")'>-</button> <span id='qntd" + dadosDoProduto[0] + "'>1</span><button onclick='mais(" + dadosDoProduto[0] + "," + vlrDoProduto + ")'>+</button><br> R$ <span class='totalVlrs' id='total"+ dadosDoProduto[0] +"'>"+ dadosDoProduto[2] +" </span><button onclick='retirar(" + dadosDoProduto[0] + ")'> Remover </button></p>";
                        // Desabilita a função de adicionar o produto que já estiver no carrinho
                        if(txtString.indexOf('btn'+codProduto) == -1){
                            document.getElementById('btn'+codProduto).removeAttribute("onclick");
                        }
                        // Torna o botão "calcular" visível
                        $("#calcular").css("display","");
                    }
                }, null); 
            });
        }
    </script>
</head>
<body>
    <!-- Links para outras páginas deste projeto -->
    <a href="cadastrarPedido.html"><button>Fazer pedido</button></a>
    <a href="cadastrarProduto.html"><button>Inserir produto</button></a>
    <a href="editarProduto.html"><button>Editar produto</button></a>
    <a href="loginUsuario.html"><button>Login</button></a>
    
    <!-- Onde os dados serão exibidos -->
    <div id="dados">
        <h1>LANCHES:</h1>
        <p id="lista-lanches">
            <script>
                exibirLanches();
            </script>
        </p>

        <h1>BEBIDAS:</h1>
        <p id="lista-bebidas">
            <script>
                exibirBebidas();
            </script>
        </p>
    </div>
    <!-- Onde os dados serão exibidos -->
    <h1>PEDIDO:</h1>
    <div id="carrinho"></div>
    <button onclick="calcular()" style="display: none;" id="calcular">Calcular</button>
    <div id="valor" style="display: none;">
        <h1>TOTAL:</h1>
        <span id="total-valor"></span>
        <button onclick="finalizar()">Finalizar pedido</button>
    </div>
</body>
</html>
